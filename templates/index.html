<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Classificador de Emails</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header>
        <h1>Classificador de Emails ‚úâÔ∏è</h1>
    </header>

    <main>
        <!-- Painel Esquerdo -->
        <div class="left-panel">
            <div class="form-box">
                <form action="/classificar" method="post" enctype="multipart/form-data">
                    <h3>Inserir texto do email:</h3>
                    <textarea name="email_texto" rows="5" placeholder="Cole aqui o texto do email"></textarea>

                    <h3>Ou fazer upload de arquivo (.txt ou .pdf):</h3>
                    <input type="file" name="email_arquivo" accept=".txt,.pdf"><br>

                    <button type="submit">Classificar</button>
                </form>
            </div>

            <!-- √öltima classifica√ß√£o -->
            {% if resultado %}
            <div class="resultado">
                <h2>√öltima Classifica√ß√£o</h2>
                <p><strong>Email inserido:</strong> {{ resultado.texto }}</p>
                <p><strong>Categoria:</strong> {{ resultado.categoria }}</p>
                <p><strong>Resposta:</strong> {{ resultado.resposta }}</p>
                <small class="email-date" data-utc="{{ resultado.data_hora.isoformat() }}"></small>
            </div>
            {% endif %}
        </div>

        <!-- Painel Direito -->
        {% if historico %}
        <div class="right-panel">
            <h2>üìÇ Hist√≥rico de Emails</h2>
            <div class="historico">
                <!-- PRODUTIVOS -->
                <div class="categoria-box produtivo">
                    <div class="categoria-header">
                        <h3>‚úÖ Produtivos</h3>
                        <div class="sort-buttons">
                            <form action="/ordenar" method="post">
                                <input type="hidden" name="categoria" value="Produtivo">
                                <input type="hidden" name="ordem" value="recentes">
                                <button type="submit">Mais Recentes</button>
                            </form>
                            <form action="/ordenar" method="post">
                                <input type="hidden" name="categoria" value="Produtivo">
                                <input type="hidden" name="ordem" value="antigos">
                                <button type="submit">Mais Antigos</button>
                            </form>
                        </div>
                    </div>
                    {% if historico['Produtivo'] %}
                        {% for email in historico['Produtivo'] %}
                        <div class="email-box">
                            <strong>Email:</strong> {{ email.texto|e }}<br>
                            <strong>Resposta:</strong> {{ email.resposta|e }}
                            <small class="email-date" data-utc="{{ email.data_hora.isoformat() }}"></small>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p><em>Nenhum email produtivo at√© agora.</em></p>
                    {% endif %}
                </div>

                <!-- IMPRODUTIVOS -->
                <div class="categoria-box improdutivo">
                    <div class="categoria-header">
                        <h3>‚ùå Improdutivos</h3>
                        <div class="sort-buttons">
                            <form action="/ordenar" method="post">
                                <input type="hidden" name="categoria" value="Improdutivo">
                                <input type="hidden" name="ordem" value="recentes">
                                <button type="submit">Mais Recentes</button>
                            </form>
                            <form action="/ordenar" method="post">
                                <input type="hidden" name="categoria" value="Improdutivo">
                                <input type="hidden" name="ordem" value="antigos">
                                <button type="submit">Mais Antigos</button>
                            </form>
                        </div>
                    </div>
                    {% if historico['Improdutivo'] %}
                        {% for email in historico['Improdutivo'] %}
                        <div class="email-box">
                            <strong>Email:</strong> {{ email.texto|e }}<br>
                            <strong>Resposta:</strong> {{ email.resposta|e }}
                            <small class="email-date" data-utc="{{ email.data_hora.isoformat() }}"></small>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p><em>Nenhum email improdutivo at√© agora.</em></p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </main>

    <script>
    // Converte todas as datas da classe "email-date" para o hor√°rio local do usu√°rio
    document.querySelectorAll('.email-date').forEach(el => {
        const utcDateStr = el.getAttribute('data-utc'); // ISO string em UTC
        const date = new Date(utcDateStr); // Converte para objeto Date
        el.textContent = date.toLocaleString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
    });
</script>
</body>
</html>
